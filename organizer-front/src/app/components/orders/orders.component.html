<div class="container mt-4">
  <!-- Indicadores de Prioridade -->
  <div class="row mb-3 text-center">
  <div class="col-6 col-md-3">
    <button class="btn btn-danger w-100"
            (click)="filterByPriority('VERMELHO')"
            (dblclick)="clearPriorityFilter()">Alta Prioridade</button>
  </div>
  <div class="col-6 col-md-3">
    <button class="btn btn-warning text-dark w-100"
            (click)="filterByPriority('AMARELO')"
            (dblclick)="clearPriorityFilter()">Média Prioridade</button>
  </div>
  <div class="col-6 col-md-3">
    <button class="btn btn-primary w-100"
            (click)="filterByPriority('AZUL')"
            (dblclick)="clearPriorityFilter()">Baixa Prioridade</button>
  </div>
  <div class="col-6 col-md-3">
    <button class="btn btn-success w-100"
            (click)="filterByPriority('VERDE')"
            (dblclick)="clearPriorityFilter()">Baixíssima Prioridade</button>
  </div>
</div>



  <!-- Tabela de Pedidos -->
  <div class="table-responsive ">
    <table class="table table-striped table-hover align-middle orders-table">
      <thead class="table-dark">
        <tr>
          <th class="text-nowrap">NR</th>
          <th class="cliente-col">CLIENTE</th>
          <th class="text-nowrap">PRIORIDADE</th>
          <th class="text-nowrap">DATA DE ENTRADA</th>
          <th class="text-nowrap">STATUS</th>
          <th class="text-center text-nowrap">ATRIBUTOS</th>
          <th class="text-nowrap">DESENHISTAS</th>
          <th class="observacao-col">OBS</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
       <ng-container *ngFor="let order of orders">
        <tr>
          <td class="text-nowrap">{{ order.nr }}</td>
          <td class="cliente-col">{{ order.cliente }}</td>
          <td class="text-nowrap" [ngStyle]="{'background-color': getPriorityColor(order.prioridade)}">
            {{ order.prioridade }}
          </td>
          <td class="text-nowrap">{{ order.dataH | date: 'dd/MM HH:mm' }}</td>
          <td class="text-nowrap">{{ getStatusDescription(order.status) }}</td>
          <td class="attributes-cell">
            <div class="d-flex flex-wrap gap-1" *ngIf="order.emborrachada || order.destacador || order.pertinax || order.poliester || order.papelCalibrado">
              <span class="badge bg-success" *ngIf="order.emborrachada">Emborrachada</span>
              <span class="badge bg-secondary" *ngIf="order.destacador">Dest: {{ order.destacador }}</span>
              <span class="badge bg-info text-dark" *ngIf="order.pertinax">Pertinax</span>
              <span class="badge bg-info text-dark" *ngIf="order.poliester">Poliéster</span>
              <span class="badge bg-info text-dark" *ngIf="order.papelCalibrado">Papel cal.</span>
            </div>
          </td>
          <td class="text-nowrap">{{ order.usuarioImportacao?.trim() || '-'}}</td>
          <td class="observacao-col">{{ order.observacao || '-' }}</td>
          <td>
            <ng-container *ngIf="canViewDxfAnalysis(); else noDxfImageButtonOrders">
              <button class="btn btn-sm btn-link text-secondary text-decoration-none" (click)="toggleImage(order.nr)" title="Ver Imagem">
                <i class="bi bi-chevron-down"></i>
              </button>
            </ng-container>
            <ng-template #noDxfImageButtonOrders>
              <button class="btn btn-sm btn-link text-secondary text-decoration-none disabled" disabled title="Sem permissão para ver imagem">
                <i class="bi bi-chevron-down"></i>
              </button>
            </ng-template>
          </td>
        </tr>
        <tr *ngIf="expandedNr === order.nr" class="bg-light">
          <td colspan="9" class="p-3">
            <div class="d-flex justify-content-center position-relative" style="min-height: 200px;">
              <div *ngIf="loadingImage[order.nr]" class="position-absolute top-50 start-50 translate-middle">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Carregando...</span>
                </div>
              </div>
              <img *ngIf="imageUrls[order.nr]" [src]="imageUrls[order.nr]" class="img-fluid border rounded shadow-sm" style="max-height: 500px; object-fit: contain;" alt="Renderização da Faca">
              <div *ngIf="!loadingImage[order.nr] && !imageUrls[order.nr]" class="text-muted py-5">
                <i class="bi bi-image-alt fs-1 d-block text-center"></i>
                <span>Imagem não disponível</span>
              </div>
            </div>
          </td>
        </tr>
       </ng-container>
      </tbody>
    </table>
<div *ngIf="!orders.length" class="text-center py-4">
      <p class="text-muted">Carregando pedidos...</p>
    </div>

  </div>
</div>
