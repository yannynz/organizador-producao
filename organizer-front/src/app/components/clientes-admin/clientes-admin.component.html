<div class="card">
  <div class="card-body">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
      <div class="d-flex gap-2 flex-grow-1" style="min-width: 280px;">
        <input type="text" class="form-control" placeholder="Buscar cliente..." [(ngModel)]="searchQuery" (keyup.enter)="search()">
        <button class="btn btn-primary" (click)="search()">Buscar</button>
      </div>
      <button class="btn btn-success text-nowrap" (click)="openNew()">
        <i class="bi bi-plus-lg"></i> Novo Cliente
      </button>
    </div>
    
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle text-sm">
        <thead>
          <tr>
            <th style="min-width: 200px;">Cliente</th>
            <th style="min-width: 180px;">Contatos</th>
            <th style="min-width: 150px;">Docs / Info</th>
            <th style="min-width: 180px;">Logística</th>
            <th style="min-width: 100px;">Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of clientes">
            <td>
              <div class="fw-bold text-truncate" style="max-width: 200px;" title="{{c.nomeOficial}}">{{c.nomeOficial}}</div>
              <div class="small text-muted" *ngIf="c.apelidos">{{c.apelidos}}</div>
              <div class="d-flex gap-1 mt-1">
                 <span class="badge rounded-pill" [class.bg-info]="c.origin==='OP'" [class.bg-secondary]="c.origin!=='OP'">{{c.origin}}</span>
                 <span class="badge bg-danger" *ngIf="!c.ativo">Inativo</span>
              </div>
            </td>
            
            <!-- Contatos: Email e Telefone -->
            <td>
              <div *ngIf="c.emailContato" class="text-truncate" style="max-width: 180px;">
                <i class="bi bi-envelope me-1"></i><a [href]="'mailto:' + c.emailContato" class="text-decoration-none">{{c.emailContato}}</a>
              </div>
              <div *ngIf="c.telefone">
                <i class="bi bi-telephone me-1"></i>{{c.telefone}}
              </div>
              <span *ngIf="!c.emailContato && !c.telefone" class="text-muted">-</span>
            </td>

            <!-- Docs: CNPJ/IE -->
            <td>
              <div *ngIf="c.cnpjCpf" class="text-nowrap"><small class="fw-bold">Doc:</small> {{c.cnpjCpf}}</div>
              <div *ngIf="c.inscricaoEstadual" class="text-nowrap"><small class="fw-bold">IE:</small> {{c.inscricaoEstadual}}</div>
              <div *ngIf="c.ultimoServicoEm" class="mt-1 small text-muted" title="Último Serviço">
                <i class="bi bi-calendar-check"></i> {{c.ultimoServicoEm | date:'dd/MM/yy'}}
              </div>
            </td>

            <!-- Logística: Transp, Padrão e Horário -->
            <td>
               <div *ngIf="c.transportadoraName" class="fw-bold text-primary text-truncate" style="max-width: 180px;"><i class="bi bi-truck me-1"></i>{{c.transportadoraName}}</div>
               <div *ngIf="c.padraoEntrega" class="badge bg-light text-dark border">{{c.padraoEntrega}}</div>
               <div *ngIf="c.horarioFuncionamento" class="small text-muted mt-1 text-truncate" style="max-width: 180px;"><i class="bi bi-clock me-1"></i>{{c.horarioFuncionamento}}</div>
            </td>

            <td>
              <button class="btn btn-sm btn-outline-primary" (click)="openEdit(c)">
                <i class="bi bi-pencil"></i> Editar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-cliente-form *ngIf="showForm" [cliente]="selectedCliente!" (save)="onSave($event)" (cancel)="onCancel()"></app-cliente-form>
