<app-advanced-filters
  [statuses]="statusList"
  [compact]="true"
  (apply)="onApplyFilters($event)"
  (clear)="onClearFilters()">
</app-advanced-filters>

<!-- DESKTOP/TABLET (≥ lg) -->
<div class="d-none d-lg-block mt-3" *ngIf="rows.length">
  <div class="table-responsive">
    <table class="table table-hover table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>NR</th>
          <th>CLIENTE</th>
          <th>PRIORIDADE</th>
          <th>ENTRADA</th>
          <th>SAÍDA</th>
          <th>STATUS</th>
          <th>ENTREGADOR</th>
          <th style="width:1%;">AÇÕES</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of rows">
          <td>{{ order.nr }}</td>
          <td>{{ order.cliente }}</td>
          <td [style.color]="getPriorityColor(order.prioridade)">{{ order.prioridade }}</td>
          <td>{{ order.dataH | date: 'dd/MM HH:mm' }}</td>
          <td>{{ order.dataEntrega ? (order.dataEntrega | date:'dd/MM HH:mm') : '—' }}</td>
          <td>{{ statusDescriptions[order.status] }}</td>
          <td>{{ order.entregador || '—' }}</td>
          <td><button class="btn btn-outline-info btn-sm" (click)="openDetails(order)">Detalhes</button></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- MOBILE (< lg): cards -->
<div class="d-lg-none mt-3" *ngIf="rows.length">
  <div class="list-group d-grid gap-3">
    <div class="list-group-item delivered-card" *ngFor="let order of rows">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="fw-bold">{{ order.nr }}</div>
          <div class="small text-muted">{{ order.cliente }}</div>
        </div>
        <div class="ms-2">
          <span class="fw-semibold" [style.color]="getPriorityColor(order.prioridade)">
            {{ order.prioridade }}
          </span>
        </div>
      </div>

      <div class="mt-2 small">
        <div>Entrada: {{ order.dataH | date:'dd/MM HH:mm' }}</div>
        <div>Saída: {{ order.dataEntrega ? (order.dataEntrega | date:'dd/MM HH:mm') : '—' }}</div>
        <div>Status: {{ statusDescriptions[order.status] }}</div>
        <div *ngIf="order.entregador">Entregador: {{ order.entregador }}</div>
      </div>

      <div class="d-flex justify-content-end mt-2">
        <button class="btn btn-outline-info btn-sm" (click)="openDetails(order)">Detalhes</button>
      </div>
    </div>
  </div>
</div>

<div class="text-center text-muted mt-3" *ngIf="!rows.length && !loading">Nenhum pedido encontrado.</div>

<!-- PAGINAÇÃO NUMERADA -->
<nav class="mt-3" *ngIf="pagesToShow.length">
  <ul class="pagination justify-content-center flex-wrap gap-1">
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link" (click)="gotoPrev()" [disabled]="currentPage === 1">«</button>
    </li>

    <li class="page-item"
        *ngFor="let p of pagesToShow"
        [class.active]="p === currentPage">
      <button class="page-link" (click)="gotoPage(p)">{{ p }}</button>
    </li>

    <li class="page-item"
        [class.disabled]="localMode ? (currentPage >= Math.ceil(localAll.length / pageSize))
                                    : !(pageMeta[currentPage]?.hasMore)">
      <button class="page-link" (click)="gotoNext()"
              [disabled]="localMode ? (currentPage >= Math.ceil(localAll.length / pageSize))
                                     : !(pageMeta[currentPage]?.hasMore)">»</button>
    </li>
  </ul>
</nav>

<app-order-details-modal
  [statusDescriptions]="statusDescriptions"
  [selectedOrder]="selectedOrder"
  [open]="detailsOpen"
  (close)="closeDetails()"
  (update)="handleUpdate($event)"
  (remove)="handleDelete($event)">
</app-order-details-modal>

